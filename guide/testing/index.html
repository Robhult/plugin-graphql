<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Vuex-ORM GraphQL Plugin | Testing</title>
    <meta name="description" content="Vue + Vuex-ORM + GraphQL = &lt;3">
    
    
    <link rel="preload" href="/plugin-graphql/assets/css/17.styles.d1ed553f.css" as="style"><link rel="preload" href="/plugin-graphql/assets/js/app.420b3d7b.js" as="script"><link rel="preload" href="/plugin-graphql/assets/js/1.713e08b7.js" as="script"><link rel="prefetch" href="/plugin-graphql/assets/js/9.a7c5b8fb.js"><link rel="prefetch" href="/plugin-graphql/assets/js/2.f32ddb23.js"><link rel="prefetch" href="/plugin-graphql/assets/js/3.33c77f31.js"><link rel="prefetch" href="/plugin-graphql/assets/js/4.f2409952.js"><link rel="prefetch" href="/plugin-graphql/assets/js/5.469068de.js"><link rel="prefetch" href="/plugin-graphql/assets/js/6.583dd875.js"><link rel="prefetch" href="/plugin-graphql/assets/js/7.84ef952b.js"><link rel="prefetch" href="/plugin-graphql/assets/js/8.4d794ada.js"><link rel="prefetch" href="/plugin-graphql/assets/js/0.566ddf0b.js"><link rel="prefetch" href="/plugin-graphql/assets/js/10.3c810f92.js"><link rel="prefetch" href="/plugin-graphql/assets/js/11.3456b0a6.js"><link rel="prefetch" href="/plugin-graphql/assets/js/12.5163bc9f.js"><link rel="prefetch" href="/plugin-graphql/assets/js/13.27dd6366.js"><link rel="prefetch" href="/plugin-graphql/assets/js/14.68d75cf3.js"><link rel="prefetch" href="/plugin-graphql/assets/js/15.c50d3380.js"><link rel="prefetch" href="/plugin-graphql/assets/js/16.15bfd352.js">
    <link rel="stylesheet" href="/plugin-graphql/assets/css/17.styles.d1ed553f.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div><a href="/plugin-graphql/" class="home-link router-link-active"><!----><span class="site-name">
      Vuex-ORM GraphQL Plugin
    </span></a><div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""><!----></div><nav class="nav-links can-hide"><div class="nav-item"><a href="/plugin-graphql/" class="nav-link">Home</a></div><div class="nav-item"><a href="/plugin-graphql/guide/" class="nav-link router-link-active">Guide</a></div><div class="nav-item"><a href="https://vuex-orm.github.io/vuex-orm/" target="_blank" rel="noopener noreferrer" class="nav-link">Vuex-ORM</a></div><div class="nav-item"><a href="https://github.com/vuex-orm/plugin-graphql" target="_blank" rel="noopener noreferrer" class="nav-link">GitHub</a></div><!----></nav></div></header><div class="sidebar-mask"></div><div class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/plugin-graphql/" class="nav-link">Home</a></div><div class="nav-item"><a href="/plugin-graphql/guide/" class="nav-link router-link-active">Guide</a></div><div class="nav-item"><a href="https://vuex-orm.github.io/vuex-orm/" target="_blank" rel="noopener noreferrer" class="nav-link">Vuex-ORM</a></div><div class="nav-item"><a href="https://github.com/vuex-orm/plugin-graphql" target="_blank" rel="noopener noreferrer" class="nav-link">GitHub</a></div><!----></nav><ul class="sidebar-links"><li><a href="/plugin-graphql/guide/" class="sidebar-link">Introduction</a></li><li><a href="/plugin-graphql/guide/setup/" class="sidebar-link">Setup</a></li><li><a href="/plugin-graphql/guide/graphql/" class="sidebar-link">GraphQL Schema</a></li><li><a href="/plugin-graphql/guide/fetch/" class="sidebar-link">fetch</a></li><li><a href="/plugin-graphql/guide/persist/" class="sidebar-link">persist</a></li><li><a href="/plugin-graphql/guide/push/" class="sidebar-link">push</a></li><li><a href="/plugin-graphql/guide/destroy/" class="sidebar-link">destroy</a></li><li><a href="/plugin-graphql/guide/connection-mode/" class="sidebar-link">Connection Mode</a></li><li><a href="/plugin-graphql/guide/custom-queries/" class="sidebar-link">Custom Queries and Mutations</a></li><li><a href="/plugin-graphql/guide/relationships/" class="sidebar-link">Relationships</a></li><li><a href="/plugin-graphql/guide/eager-loading/" class="sidebar-link">Eager Loading</a></li><li><a href="/plugin-graphql/guide/virtual-fields/" class="sidebar-link">Virtual Fields</a></li><li><a href="/plugin-graphql/guide/meta-fields/" class="sidebar-link">Meta Fields</a></li><li><a href="/plugin-graphql/guide/testing/" class="active sidebar-link">Testing</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/plugin-graphql/guide/testing/#unit-testing" class="sidebar-link">Unit Testing</a></li><li class="sidebar-sub-header"><a href="/plugin-graphql/guide/testing/#misc" class="sidebar-link">Misc</a></li><li class="sidebar-sub-header"><a href="/plugin-graphql/guide/testing/#integration-testing" class="sidebar-link">Integration Testing</a></li></ul></li><li><a href="/plugin-graphql/guide/faq/" class="sidebar-link">Frequently Asked Questions</a></li><li><a href="/plugin-graphql/guide/contribution/" class="sidebar-link">Contribution</a></li></ul></div><div class="page"><div class="content"><h1 id="testing"><a href="#testing" aria-hidden="true" class="header-anchor">#</a> Testing</h1><p></p><div class="table-of-contents"><ul><li><a href="#unit-testing">Unit Testing</a><ul><li><a href="#fetch">Fetch</a></li><li><a href="#persist">Persist</a></li><li><a href="#push">Push</a></li><li><a href="#destroy">Destroy</a></li><li><a href="#query">Query</a></li><li><a href="#mutate">Mutate</a></li><li><a href="#simple-query">Simple Query</a></li><li><a href="#simple-mutation">Simple Mutation</a></li><li><a href="#resetting-a-mock">Resetting a mock</a></li></ul></li><li><a href="#misc">Misc</a></li><li><a href="#integration-testing">Integration Testing</a></li></ul></div><p></p><h2 id="unit-testing"><a href="#unit-testing" aria-hidden="true" class="header-anchor">#</a> Unit Testing</h2><p>To unit test vue components which use the persistence actions of this plugin, you need to mock
the results of the GraphQL queries. The GraphQL plugin offers some utils to do this.</p><p>First we have to import the mock method from the test utils via</p><pre class="language-js"><code><span class="token keyword">import</span> VuexORMGraphQL <span class="token keyword">from</span> <span class="token string">'@vuex-orm/plugin-graphql'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> setupTestUtils<span class="token punctuation">,</span> mock <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'@vuex-orm/plugin-graphql/lib/test-utils'</span><span class="token punctuation">;</span>
</code></pre><p>After that we have to setup the test utils, this is very easy, just pass the imported VuexORMGraphQL
plugin like this:</p><pre class="language-text"><code>setupTestUtils(VuexORMGraphQL);
</code></pre><p>Now we're ready to go. In the next step we can setup mocks via</p><pre class="language-js"><code><span class="token function">mock</span><span class="token punctuation">(</span><span class="token string">'fetch'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token keyword">for</span><span class="token punctuation">(</span>User<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">andReturn</span><span class="token punctuation">(</span><span class="token punctuation">{</span> id<span class="token punctuation">:</span> <span class="token number">1</span><span class="token punctuation">,</span> name<span class="token punctuation">:</span> <span class="token string">'Charlie Brown'</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><p>This means: Whenever <code>User.fetch()</code> is called, insert <code>{ id: 1, name: 'Charlie Brown' }</code> in the Vuex-ORM
store.</p><p>The mock method also accepts a second param which allows to match specific calls. Only those
properties which are within the given object are considered while matching. Example:</p><pre class="language-js"><code><span class="token comment">// Will only trigger when `User.fetch(17)` is called </span>
<span class="token function">mock</span><span class="token punctuation">(</span><span class="token string">'fetch'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> filter<span class="token punctuation">:</span> <span class="token punctuation">{</span> id<span class="token punctuation">:</span> <span class="token number">17</span> <span class="token punctuation">}</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token keyword">for</span><span class="token punctuation">(</span>User<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">andReturn</span><span class="token punctuation">(</span><span class="token punctuation">{</span> id<span class="token punctuation">:</span> <span class="token number">17</span><span class="token punctuation">,</span> name<span class="token punctuation">:</span> <span class="token string">'Charlie Brown'</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Will only trigger when `User.fetch({ filter: { active: true }})` is called</span>
<span class="token function">mock</span><span class="token punctuation">(</span><span class="token string">'fetch'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> filter<span class="token punctuation">:</span> <span class="token punctuation">{</span> active<span class="token punctuation">:</span> <span class="token boolean">true</span> <span class="token punctuation">}</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token keyword">for</span><span class="token punctuation">(</span>User<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">andReturn</span><span class="token punctuation">(</span><span class="token punctuation">[</span>
  <span class="token punctuation">{</span> id<span class="token punctuation">:</span> <span class="token number">17</span><span class="token punctuation">,</span> name<span class="token punctuation">:</span> <span class="token string">'Charlie Brown'</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">{</span> id<span class="token punctuation">:</span> <span class="token number">18</span><span class="token punctuation">,</span> name<span class="token punctuation">:</span> <span class="token string">'Snoopy'</span> <span class="token punctuation">}</span>
<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><p>Additionally the argument of <code>andReturn</code> can be a function, which will be called each time the mock
is triggered.</p><p>The following examples describe how each action type can be mocked.</p><h3 id="fetch"><a href="#fetch" aria-hidden="true" class="header-anchor">#</a> Fetch</h3><pre class="language-js"><code><span class="token comment">// This mock call</span>
<span class="token function">mock</span><span class="token punctuation">(</span><span class="token string">'fetch'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> filter<span class="token punctuation">:</span> <span class="token punctuation">{</span> id<span class="token punctuation">:</span> <span class="token number">42</span> <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token keyword">for</span><span class="token punctuation">(</span>User<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">andReturn</span><span class="token punctuation">(</span>userData<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// will be triggerd by</span>
User<span class="token punctuation">.</span><span class="token function">fetch</span><span class="token punctuation">(</span><span class="token number">42</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><h3 id="persist"><a href="#persist" aria-hidden="true" class="header-anchor">#</a> Persist</h3><pre class="language-js"><code><span class="token comment">// This mock call</span>
<span class="token function">mock</span><span class="token punctuation">(</span><span class="token string">'persist'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> id<span class="token punctuation">:</span> <span class="token number">17</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token keyword">for</span><span class="token punctuation">(</span>User<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">andReturn</span><span class="token punctuation">(</span><span class="token punctuation">{</span> id<span class="token punctuation">:</span> <span class="token number">17</span><span class="token punctuation">,</span> name<span class="token punctuation">:</span> <span class="token string">'Charlie Brown'</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// will be triggerd by</span>
user<span class="token punctuation">.</span><span class="token function">$persist</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><h3 id="push"><a href="#push" aria-hidden="true" class="header-anchor">#</a> Push</h3><pre class="language-js"><code><span class="token comment">// This mock call</span>
<span class="token function">mock</span><span class="token punctuation">(</span><span class="token string">'push'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> data<span class="token punctuation">:</span> <span class="token punctuation">{</span> <span class="token operator">...</span> <span class="token punctuation">}</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token keyword">for</span><span class="token punctuation">(</span>User<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">andReturn</span><span class="token punctuation">(</span><span class="token punctuation">{</span> id<span class="token punctuation">:</span> <span class="token number">17</span><span class="token punctuation">,</span> name<span class="token punctuation">:</span> <span class="token string">'Charlie Brown'</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// will be triggerd by</span>
user<span class="token punctuation">.</span><span class="token function">$push</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><h3 id="destroy"><a href="#destroy" aria-hidden="true" class="header-anchor">#</a> Destroy</h3><pre class="language-js"><code><span class="token comment">// This mock call</span>
<span class="token function">mock</span><span class="token punctuation">(</span><span class="token string">'destroy'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> id<span class="token punctuation">:</span> <span class="token number">17</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token keyword">for</span><span class="token punctuation">(</span>User<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">andReturn</span><span class="token punctuation">(</span><span class="token punctuation">{</span> id<span class="token punctuation">:</span> <span class="token number">17</span><span class="token punctuation">,</span> name<span class="token punctuation">:</span> <span class="token string">'Charlie Brown'</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// will be triggerd by</span>
user<span class="token punctuation">.</span><span class="token function">$destroy</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><h3 id="query"><a href="#query" aria-hidden="true" class="header-anchor">#</a> Query</h3><h3 id="mutate"><a href="#mutate" aria-hidden="true" class="header-anchor">#</a> Mutate</h3><pre class="language-js"><code><span class="token comment">// This mock call</span>
<span class="token function">mock</span><span class="token punctuation">(</span><span class="token string">'mutate'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> name<span class="token punctuation">:</span> <span class="token string">'upvote'</span><span class="token punctuation">,</span> args<span class="token punctuation">:</span> <span class="token punctuation">{</span> id<span class="token punctuation">:</span> <span class="token number">4</span> <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token keyword">for</span><span class="token punctuation">(</span>Post<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">andReturn</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token operator">...</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// will be triggerd by</span>
post<span class="token punctuation">.</span><span class="token function">$mutate</span><span class="token punctuation">(</span><span class="token punctuation">{</span> name<span class="token punctuation">:</span> <span class="token string">'upvote'</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><h3 id="simple-query"><a href="#simple-query" aria-hidden="true" class="header-anchor">#</a> Simple Query</h3><p>Mocking simple queries works slightly different then the other actions, because these are not model
related. Thus we have to mock these globally by omiting the model (<code>for</code>):</p><pre class="language-js"><code><span class="token comment">// This mock call</span>
<span class="token function">mock</span><span class="token punctuation">(</span><span class="token string">'simpleQuery'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> name<span class="token punctuation">:</span> <span class="token string">'example'</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">andReturn</span><span class="token punctuation">(</span><span class="token punctuation">{</span> success<span class="token punctuation">:</span> <span class="token boolean">true</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// will be triggered by</span>
store<span class="token punctuation">.</span><span class="token function">dispatch</span><span class="token punctuation">(</span><span class="token string">'entities/simpleQuery'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> query<span class="token punctuation">:</span> <span class="token string">'query example { success }'</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><h3 id="simple-mutation"><a href="#simple-mutation" aria-hidden="true" class="header-anchor">#</a> Simple Mutation</h3><p>Works just like the simple queries:</p><pre class="language-js"><code><span class="token comment">// This mock call</span>
<span class="token function">mock</span><span class="token punctuation">(</span><span class="token string">'simpleMutation'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
  name<span class="token punctuation">:</span> <span class="token string">'SendSms'</span><span class="token punctuation">,</span>
  variables<span class="token punctuation">:</span> <span class="token punctuation">{</span> to<span class="token punctuation">:</span> <span class="token string">'+4912345678'</span><span class="token punctuation">,</span> text<span class="token punctuation">:</span> <span class="token string">'GraphQL is awesome!'</span> <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">andReturn</span><span class="token punctuation">(</span><span class="token punctuation">{</span> sendSms<span class="token punctuation">:</span> <span class="token punctuation">{</span> delivered<span class="token punctuation">:</span> <span class="token boolean">true</span> <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// will be triggered by</span>
<span class="token keyword">const</span> query <span class="token operator">=</span> <span class="token template-string"><span class="token string">`
mutation SendSms($to: string!, $text: string!) {
  sendSms(to: $to, text: $text) {
    delivered
  }
}`</span></span><span class="token punctuation">;</span>

<span class="token keyword">const</span> result <span class="token operator">=</span> <span class="token keyword">await</span> store<span class="token punctuation">.</span><span class="token function">dispatch</span><span class="token punctuation">(</span><span class="token string">'entities/simpleMutation'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
  query<span class="token punctuation">,</span>
  variables<span class="token punctuation">:</span> <span class="token punctuation">{</span> to<span class="token punctuation">:</span> <span class="token string">'+4912345678'</span><span class="token punctuation">,</span> text<span class="token punctuation">:</span> <span class="token string">'GraphQL is awesome!'</span> <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><h3 id="resetting-a-mock"><a href="#resetting-a-mock" aria-hidden="true" class="header-anchor">#</a> Resetting a mock</h3><div class="warning custom-block"><p class="custom-block-title">WARNING</p><p>Support for resetting a mock is currently work in progress and will be added soon.</p><p>See https://github.com/vuex-orm/plugin-graphql/issues/61</p></div><h2 id="misc"><a href="#misc" aria-hidden="true" class="header-anchor">#</a> Misc</h2><p>The testing utils also provide some other useful functions, which are listed here:</p><ul><li><code>async clearORMStore()</code>: Will remove all records from the Vuex-ORM store to clean up while testing.</li></ul><h2 id="integration-testing"><a href="#integration-testing" aria-hidden="true" class="header-anchor">#</a> Integration Testing</h2><div class="warning custom-block"><p class="custom-block-title">WARNING</p><p>Support for integration testing is currently work in progress and will be added soon.</p><p>See https://github.com/vuex-orm/plugin-graphql/issues/59</p></div></div><!----><div class="content page-nav"><p class="inner"><span class="prev">
        ← <a href="/plugin-graphql/guide/meta-fields/" class="prev">
          Meta Fields
        </a></span><span class="next"><a href="/plugin-graphql/guide/faq/">
          Frequently Asked Questions
        </a> →
      </span></p></div></div></div></div>
    <script src="/plugin-graphql/assets/js/1.713e08b7.js" defer></script><script src="/plugin-graphql/assets/js/app.420b3d7b.js" defer></script>
  </body>
</html>
